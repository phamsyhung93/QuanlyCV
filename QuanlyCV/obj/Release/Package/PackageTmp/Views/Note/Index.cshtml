@model IEnumerable<QuanlyCV.Models.Note>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="body-folder-Manager" style="margin-bottom: 10px;">
    <div class="container">
        <div class="row" style="flex-direction: row;display: flex;">
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                <div class="sale-statistic-inner notika-shadow">
                    <div class="curved-inner-pro text-center">
                        <div style="padding: 20px 0px;">
                            <span style="font-size: 20px; color:#909090;font-weight: bold;">Danh Sách Ghi CHú</span>
                            <br />
                            <h4 style="color:darkred">@TempData["error"]</h4>
                        </div>
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div id="sidebar-wrapper" class="sidebar-toggle kehoach" style="overflow: auto; overflow-x:hidden;background-color: #00bcd4">
                            <ul class="">
                                @foreach (var item in Model)
                                {
                                    <li>
                                        <a class="li-menu-left active" data-id="@item.NoteId" id="li-menu-left-one" onclick="setActiveMenuleft(this)">
                                            <div class="sidebar-left" style="padding: 10px;">
                                                <div class="p-center">
                                                    <p class="p-center-content-title">@item.NoteContent</p>
                                                </div>
                                                @*<div class="p-center">
                                                        <p class="p-center-title">Thời Gian: </p>
                                                        <p class="p-center-content">18/10/2018</p>
                                                    </div>*@
                                            </div>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                        <div class="btn-action-bottom-left">
                            <a class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center btn-add-menu-left" href="#" onclick="openModalAddPlan()" title="Thêm" style="padding: 10px;background-color: #00bcd4;color: #fff">Thêm</a>
                        </div>
                        <div id="modalAddPlan" class="modal">
                            <!-- Modal content -->
                            <div class="modal-content">
                                <span class="closeModalAddPlan">&times;</span>
                                <br />
                                <br />
                                <form action="@Url.Action("Create","Note")" method="post">
                                    <span>Nội Dung Ghi Chú</span>
                                    <textarea type="text" name="NoteContent" required="required" style="width: 100% ;border: none;background-color: #c1c1c1"></textarea>
                                    <input type="hidden" name="EmployeeId" required="required" style="width: 100%;border: none;background-color: #c1c1c1" value="@ViewBag.EmployeeId">
                                    <span>Trạng thái</span>
                                    <select name="NoteStatus" id="NoteStatus" class="form-control" required="required" style="width: 100%;border: none;background-color: #c1c1c1">
                                        <option value="1">Hiển Thị</option>
                                        <option value="2">Không Hiển Thị</option>
                                    </select>
                                    <br />
                                    <input type="submit" name="" value="Thêm" style="background-color:#67b459 ;border: none;border-radius: 4px;color:#fff;padding: 5px">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8" style="width: 900px; margin-top: 65px;background-color: #c1c1c1;border-radius: 4px;">
                <div style="margin-top:10px;padding: 10px;max-width: 100%" class="content-note">
                    <div class="btn-edit-delete" style="flex-direction: row;display: flex">
                        <a onclick="UpdateNote(this)" data-id="@ViewBag.Note.NoteId" style="background-color:#00bcd4;color:#fff;padding:5px 10px;border: none;border-radius: 4px;">Sửa</a>
                        <a onclick="Delete(this)" data-id="@ViewBag.Note.NoteId" style="background-color:#eb5a46;color:#fff;padding:5px 10px;border: none;border-radius: 4px;" href="#">Xóa</a>
                    </div>
                    <div style="max-width: 100%;padding: 10px;margin-top:10px;background-color: #fff;border-radius: 4px;max-height: 410px;height: 410px;">
                        <textarea style="border:none;max-width: 100%;max-height: 390px;height: 390px; resize: none;" data-id="@ViewBag.Note.NoteId" onchange="changeContentNote(this)">@ViewBag.Note.NoteContent</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        var content = "";
        function setActiveMenuleft(e) {
            var id = $(e).data("id");
            $(".li-menu-left").removeClass('active');
            $(e).addClass('active');
            $(e).css("opacity", 0.5);
            $.ajax({
                type: "POST",
                url: "@Url.Action("LoadContentNote", "Note")",
                data: { id: id },
                success: function (rps) {
                    $(".content-note").html(rps);
                }
            });
        }

        function changeContentNote(e) {
            content = $(e).val();
        }

        function UpdateNote(e) {
            var id = $(e).data("id");
            $.ajax({
                type: "POST",
                url: "@Url.Action("updateNote", "Note")",
                data: { id: id, NoteContent: content },
                success: function (rps) {
                    location.reload();
                }
            });
        }

        function Delete(e) {
            var id = $(e).data("id");
            swal({
                title: "Bạn Có Muốn Xóa Không?",
                text: "",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("DeleteNote", "Note")",
                        data: { id: id },
                        success: function (rps) {
                            location.reload();
                        }
                    });
                } else {
                    return false;
                }
            });
        }

    </script>
}
